# 1.重装系统
[TOC]
# 一 简介
## 1 windows系统安装方法汇总
1. 直接法
下载ISO镜像直接点击setup覆盖安装；或点击sources目录下的setup安装，此时可以选择盘符或构成多系统。
2. 部署法
命令提示符输入DISM /Apply-Image /ImageFile:D:\sources\install.wim /ApplyDir:C: /Index:1
(可在当前系统或符合条件的PE上操作，这里的“D”指的是挂载的光盘镜像，“C”指的是准备安装的盘符，“1”指的是索引1，根据镜像特点选择，如果镜像中只有一个索引的，请输入1）
bcdboot C:\windows /l zh-cn
(此为引导菜单，“C”指的是准备安装的盘符，根据不同情况自行调整，默认状态下是会正确的）
3. 引导菜单法
如nt6引导菜单，下载nt6，解压或挂载镜像后复制所有文件到任意一盘符根目录下，启动NT6，点击安装，点击重启，选择nt6菜单（两个模式任选一个），继续安装即可
4. 工具法
使用WinNTSetup一类的工具加载install.esd或install.wim安装
5. U盘启动盘法
加载镜像复制文件到任意一U盘（或解压到U盘，或采用软碟通将镜像写入U盘），重启选择U盘（uefi启动的请选择带有efi字样的启动项）
6. 备份恢复法
命令提示符（管理员）输入DISM /Get-WimInfo /WimFile:"C:\Recovery\install.esd"
ReAgentc /setosimage /path C:\Recovery\ /index 1
(这里的“C"指的是恢复镜像所在盘符，“1”指的是你需要安装的索引，根据第一个命令获取影响的索引，“install.esd"也可以是“install.wim”，根据你的影响格式调整）

## 3 常识
### 3.1 gho和iso
1. GHO扩展名，即为俗称的克隆版安装文件。可以使用GHOST工具安装Windows 7 系统。
2. ISO扩展名的安装文件多为原装系统。解压之后应该有setup.exe文件，双击就能安装了。
3. ISO本身就是压缩文件，可以使用RAR解压。如果是ghost版的ISO光盘，解压之后，里面是有gho文件的。

## 4 文档网址等
1. https://uefi.org/specifications

# 三 基础
## 0 架构
## 1 工具生态
## 2 电脑的启动方式
几种电脑的启动方式(Boot Mode)
1. legacy传统：启动程序以固件的形式存储在计算机的主板上，负责电脑的自检、硬件初始化(因为BIOS需要依次初始化各个硬件设备，例如硬盘、内存和显示器等，这个过程需要消耗大量的时间)、引导操作系统等任务。legacy启动通常十多秒起步。
    1. 只支持MBR磁盘分区格式，只能处理容量小于2TB的硬盘
2. UEFI：是legacy的改进版。支持文件系统、有图形界面(更加现代化的图形界面，还能切换语言，更方便进行管理)，可以跳过硬件的自检，支持硬件加速和并行处理，启动速度更快。通常几秒钟就可以启动系统。
    1. 只支持GPT分区格式，能够支持超过2TB的硬盘容量，而且还可以进行网络启动和安全启动等，并具有更加灵活的驱动程序支持
3. legacy+UEFI

启动方式的兼容性：
1. Win8以上操作系统不管是64位还是32位都支持UEFI启动
2. Win7以下系统32位不支持UEFI启动，64位支持
3. XP不支持UEFI启动（原因是不支持GPT磁盘，通过移植Win Sever 2003里的 disk.sys 并做一些修改可以使64位的XP SP2支持UEFI）
4. 一般的PC无法使用32位的UEFI安装32位Win8以上系统，原因是BIOS只支持64位的UEFI引导，绝大部分PC都是如此，所以不要随意尝试UEFI安装32位的Win8以上系统。

如何查看当前系统的启动方式：运行`msinfo32` -> BIOS模式（显示传统 or UEFI）

## 3 磁盘管理
几种磁盘分区表
1. MBR(Master Boot Record)：MBR是最传统的磁盘格式，主分数（主分区和扩展分区的总数）不能高于4个，所以最多只能创建四个主分区或者三个主分区+一个扩展分区（若干逻辑分区），最大支持硬盘容量2TB。xp系统只支持MBR引导。
2. GUID（GUID Partition Table，缩写GPT）
    1. 优点
        1. 分区数：最多128个主分区
        2. 分区大小：最大支持容量18EB。GUID盘（也就是GPT盘）能管理2TB以上磁盘，配合UEFI引导能更快启动
        3. 分区表自带备份。在磁盘的首尾部分分别保存了一份相同的分区表。其中一份被破坏后，可以通过另一份恢复。

磁盘分区表格式转换

1. win10下MBR转GPT：可以使用官方提供的MBR2GPT工具

几种磁盘格式：
1. windows系统支持的磁盘格式
    1. FAT(File Allocation Table，文件配置表): 缺点是单个文件不超过4GB。现在基本上已经不再使用。
        1. FAT16
        2. FAT32
    2. NTFS: 能存储单个文件大于4GB的文件，还能对磁盘进行加密、加压等操作
    3. exFAT（Extended File Allocation Table，拓展式文件配置表）：2006年的时候微软推出了exFAT文件系统，这是一种专门为移动设备进行了优化的文件系统。对于闪存类移动设备来说exFAT是文件系统的最优解。
        1. 解决了FAT32单个文件4GB大小的限制，支持最大256TB的分区大小，单文件大小支持128PB
        2. exFAT诞生时间比较晚，所以对于老旧的操作系统不提供支持，严格来说WindowsXP SP2之前的系统都无法识别
        3. exFAT的原理跟NTFS不同，在对文件进行操作的时候并不需要像NTFS一样记录日志文件，也就避免了对移动设备的持续读写，增加了移动设备的使用寿命。
2. linux系统支持的磁盘格式
    1. ext

动态磁盘和基本磁盘

windows的基本磁盘和动态磁盘：官方更推荐使用基本磁盘。
1. 参考：https://learn.microsoft.com/zh-cn/windows/win32/fileio/basic-and-dynamic-disks
2. 主要区别
    1. 动态磁盘允许卷在一个或多个物理磁盘上具有不连续的盘区，而基本磁盘上的卷只能由单个磁盘上的一组连续盘区组成。也就是说，基本磁盘只能将磁盘按照物理区域进行分区，而动态磁盘能够将磁盘在物理上不连续的区域划分为逻辑上连续的分区。
    2. 动态磁盘的分区（卷）没法合并，基本磁盘的分区可以合并。
    3. 动态磁盘没法新装系统，已经存在的系统不影响。
    4. 基本磁盘受26个英文字母的限制，也就是说磁盘的盘符只能是26个英文字母中的一个。因为A、B已经被软驱占用，实际上磁盘可用的盘符只有C～Z 24个。另外，在“基本磁盘”上只能建立四个主分区（注意是主分区，而不是扩展分区）。而动态磁盘不受26个英文字母的限制，它是用“卷”来命名的。（待验证）
    4. 将动态磁盘搬移到别的机器上以后，启动后往往不会自动联机，必须到“磁盘管理”里面手动选择“联机”或者“激活”或者“导入外部磁盘”后才可继续使用
3. 操作
    1. 动态磁盘转换成基本磁盘：**需要将动态磁盘格式化**
4. 为什么不推荐使用动态磁盘
    1. 动态磁盘难以转换回基本磁盘：需要格式化
    2. 动态磁盘上无法新安装系统（无法安装多系统）: 如果某块基本磁盘上已经装了系统，那么将该磁盘转换成动态磁盘是没有问题的，但是如果已经是动态磁盘，那就无法再装系统

分区/卷
1. 几种卷
    1. 简单卷
    2. 跨区卷：将多个磁盘的内容合并成一个卷，跨区卷在写数据时一般是先写满第一个磁盘再去写第二个，以此类推。跨区卷可以创建出大容量的卷，但并不能提高读写速度。创建跨区卷会自动将涉及到的磁盘变成动态磁盘。
    3. 带区卷：将多个**同样大小的磁盘?**合并成一个卷，能提高读写速度(非线性)，类似于软raid。缺点是其中一块磁盘出问题了的话，整个带区卷可能都无法访问。创建带区卷会自动将涉及到的磁盘变成动态磁盘。
    4. 镜像卷：类似于软raid1技术，适合储存重要的数据。
    5. RAID-5卷：带区卷+镜像卷
2. 主分区
    1. 系统分区
3. 扩展分区
    1. 逻辑分区/逻辑驱动器

## 4 硬盘
常见硬盘协议：
1. 上层协议
    1. AHCI：Advanced Host Controller Interface的首字母缩写，即高级主机控制器接口。
    2. NVMe：Non Volatile Memory Host Controller Interface Specification的首字母缩写，即非易失性内存主机控制器接口规范。
2. 传输总线
    1. SATA：Serial ATA的缩写，即串行ATA。它是由“SATA工作组”在2000年11月提出的一种计算机总线。主要是用于主板与大容量存储设备进行数据传输。该总线具有结构简单和支持热插拔的特点。SATA接口有SATA1.0，SATA2.0，SATA3.0。所有的SATA向前兼容，接口一样，只是传输速度不同而已。
        1. mSATA接口：miniSATA，通过名称就能看出来它是SATA的迷你版。尺寸更小。
    2. PCIe：Peripheral component interconnect express的首字母缩写，即高速串行计算机扩展总线标准。目前有PCIe1.0、PCIe2.0、PCIe3.0、PCIe4.0、PCIe5.0几个版本，不同版本传输速率不同。
        1. M.2接口：有两种类型，NVMe（M key）和NGFF（B key）。


### 机械硬盘
HDD是Hard Disk Driver的首字母缩写，一般称为“机械硬盘”

磁记录方式分为：
- LMR：Longitudinal Magnetic Recording 水平磁记录
- PMR：Perpendicular Magnetic Recording 垂直磁记录

现在主要用的就是PMR，它又分为：
- CMR：Conventional Magnetic Recording 传统磁记录
- SMR：Shingled Magnetic Recording 叠瓦磁记录

一般CMR性能好于SMR。

机械硬盘HDD长期断电后，数据可以保存10年以上。


### 固态硬盘
SSD是Solid State Disk的首字母缩写，一般称为“固态硬盘”。SSD与机械硬盘HDD不同，它没有活动机构。而是使用NAND闪存技术存储。固态硬盘SSD通过电子电路来读取写入数据。由于不需要机械机构完成读写，所以SSD的功耗要比HDD低。

固态硬盘SSD在连续断电1年后，就会因为浮栅内的电子衰减而彻底丢失数据，并且该丢失的数据不可恢复。(todo)

# 五 经验
## 1 重装系统实战
几种方法
1. 官方工具重装win10
    1. 在官网下载工具MediaCreationTool（如果用mac访问则只有iso的下载而没有工具下载），插入u盘运行工具，选择下载iso文件并制作到U盘  
    过程中会要求c盘有至少8G空间，u盘大概2~3G空间（我估计是先下载到c盘并解压然后再制作到u盘）
    2. 重启选择u盘启动就进入安装了，不过这样直接安装的是没有激活的，方法自行百度或支持正版
