# 6.MySQL
[TOC]

# 一 概述
## 1 简介
1. mysql是开源的关系型数据库管理系统，最早由MySQL AB公司开发，目前属于oracle公司
1. MySQL数据库命令不区分大小写。但在MAC的终端，如果你想使用tab自动补全命令，那么你就必须使用大写

## 3 常识
### 3.1 mysql用什么语言写的
mysql是c语言写的，红帽系统中默认有mysql

# 二 安装配置
## 1 mac
### dmg安装
在mac下dmg安装后会有两个mysql的目录：/usr/local/mysql, 这是一个link，指向/usr/local/mysql-xxxxx...(即实际的mysql目录)

### brew安装

### 从低版本升级上来
运行脚本`mysql_upgrade -u root -p`

### 配置
mysql的配置文件路径查找优先级为`/etc/my.cnf`,`/etc/mysql/my.cnf`,`/usr/local/etc/my.cnf`，通过Homebrew安装的my.cnf放在`/usr/local/etc/`中。

```bash
```

mysql数据文件存放目录`/usr/local/var/mysql`，不同系统可能不一样，可通过`show variables like "%datadir%";`查看

## 2 win
1. msi是安装版，zip是免安装版，后者比前者大而且配置好可能要花一番功夫

## 3 linux

# 三 基础

### 7.6 order by
```sql
-- 值为null的字段的排序：升序的时候，null默认被放在最前，降序的时候，null默认被放在最后
-- 1. ORDER BY IF(ISNULL(update_date),0,1) null被强制放在最前，ORDER BY IF(ISNULL(update_date),1,0) null被强制放在最后
```

### 7.7 规定要返回的记录的数目
使用`LIMIT`（待补充）

# 四 高级
## 1 mysql命令行
使用：
1. 登录：`mysql -u userNameA -p passwordA`或`mysql -uuserNameA -ppasswordA`
2. 查看所有数据库`show databases;`
3. 进入数据库`use dbnameA;`
4. 查看所有表`show tables;`
5. 查看表定义`desc tableA`
5. 查看编码`show variables like 'character_set_%';`
6. 按行垂直显示结果`...\G`，也可以在登录的时候设置，带上`-E`，如`mysql -u xxx -E`
    
    ```sql
    select * from user\G
    ```
7. 使用`pager`或者`\P`设置显示方式
    
    ```bash
    # pager more 或者 \P more
    PAGER set to 'more'
    
    # pager less 或者 \P less
    PAGER set to 'less'
    
    # nopager
    PAGER set to stdout
    ```
8. 使用`tee fileA`或`\T fileA`保存运行结果到文件,类似于sqlplus的spool功能，可以将命令行中的结果保存到外部文件中。如果指定已经存在的文件，则结果会附加到文件中。使用`notee`或者`\t`关闭它
9. 执行shell命令`system cmdA`或者`\! cmdA`
    
    ```sql
    system uname
    \! uname
    ```
10. 执行SQL文件`source xxx.sql`或者`\. xxx.sql`
11. SQL预编译

    ```sql
    PREPARE stmt1 FROM 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
    Query OK, 0 rows affected (0.00 sec)
    Statement prepared

    SET @a = 3;
    Query OK, 0 rows affected (0.00 sec)

    SET @b = 4;                                                   
    Query OK, 0 rows affected (0.00 sec)

    EXECUTE stmt1 USING @a, @b;
    +------------+
    | hypotenuse |
    +------------+
    |          5 |
    +------------+
    1 row in set (0.01 sec)

    DEALLOCATE PREPARE stmt1;                                     
    Query OK, 0 rows affected (0.00 sec)
    ```

## 2 mysql图形界面工具
1. MySQL GUI Tools
由mysql官方提供的早期的图形界面工具，现在下载界面可以看到“Please note that development of MySQL GUI Tools has been discontinued. ”，而是推荐使用MySQL Workbench
2. MySQL Workbench
是下一代的可视化数据库设计、管理的工具，它同时有开源和商业化的两个版本，支持多系统。前身是FabForce公司的DBDesigner4。
3. navicat
用得应该是最多的
4. sequel pro
支持mac平台，是由Cocoa和面对对象的C（Mac OSX）编写的，看到有些大牛在用
4. SQLyog
5. mysqlcc

# 五 经验
1. 今天在命令行里创建表，字段名和表名我都没加``，结果一直最后一行报错，然后我加上它就好了。以前好像不用加的，难道我记错了？
2. workbench左下角显示[not connection]()，原因在于没有启动数据库服务

# 六 问题
## 1 use dbNameA 进入数据库时出现信息：Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A
原因是mysql进入数据库会预读数据库信息，数据库太大会导致进入时很慢，所以提示说的是在登录数据库的时候加上参数`-A`

## 2 ERROR 2059 (HY000): Authentication plugin 'caching_sha2_password' cannot be loaded; 
方法一(待验证)：
1. 增加配置`default_authentication_plugin = mysql_native_password`
2. `alter user 'root'@'localhost' identified with mysql_native_password by 'xxx';`

## 3 忘记密码的找回(待验证)
1. 关闭服务
2. 进入目录 cd /usr/local/mysql/bin/ ，输入 sudo su ，回车后输入 ./mysqld_safe --skip-grant-tables & （别忘了末尾 &）
3.  输入  ./mysql ，进入mysql后输入  mysql> flush privileges ;
4.  回车后输入  mysql> set password for 'root'@'localhost'='newPassA'
5. done

# 七 未整理
1. 我的mac上安装的mysql没有类似my.default的配置文件，网上说的要自己在etc目录下新建一个my.cnf
2. mysql的自动补全需要在配置文件中设置一下，由于我的mac中没找到配置文件，暂时不折腾
3. mysql连接数的极限是多少：300到700(300是机械硬盘的理想情况，实际可能200就gg)
